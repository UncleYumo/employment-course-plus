<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>青云打地鼠</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .game-container {
            width: 95%;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 15px;
        }

        .score-board {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 18px;
        }

        .time-board {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 18px;
        }

        .game-title {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .hole {
            aspect-ratio: 1/1;
            background: #8B4513;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 8px 0 rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .hole::before {
            content: '';
            position: absolute;
            width: 80%;
            height: 20%;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 50%;
            bottom: 10%;
        }

        .mole {
            width: 90%;
            height: 90%;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .mole.up {
            transform: translateY(0);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-start {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
        }

        .btn-stop {
            background: linear-gradient(45deg, #f44336, #ff9800);
            color: white;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .game-message {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            border-radius: 20px;
        }

        .message-content {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 80%;
        }

        .message-title {
            font-size: 32px;
            margin-bottom: 20px;
            color: #FFD700;
        }

        .final-score {
            font-size: 24px;
            margin: 20px 0;
        }

        .hidden {
            display: none;
        }

        .instructions {
            margin: 15px 0;
            font-size: 16px;
            line-height: 1.5;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
        }

        .sound-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .sound-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .sound-btn.active {
            background: #4CAF50;
        }

        @media (max-width: 500px) {
            .game-container {
                width: 98%;
                padding: 15px;
            }

            .game-title {
                font-size: 24px;
            }

            .score-board, .time-board {
                font-size: 16px;
                padding: 8px 15px;
            }

            .btn {
                padding: 10px 20px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
<div class="game-container">
    <div class="game-header">
        <div class="score-board">得分: <span id="score">0</span></div>
        <div class="time-board">时间: <span id="time">30</span>s</div>
    </div>

    <h1 class="game-title">青云打地鼠</h1>

    <div class="instructions">
        点击出现的青云头像得分！30秒内得分越高越好！
    </div>

    <div class="game-board" id="gameBoard">
        <!-- 地鼠洞将通过JavaScript生成 -->
    </div>

    <div class="controls">
        <button class="btn btn-start" id="startBtn">开始游戏</button>
        <button class="btn btn-stop" id="stopBtn">结束游戏</button>
    </div>

    <div class="sound-controls">
        <div class="sound-btn active" id="bgmBtn" title="背景音乐">🎵</div>
        <div class="sound-btn active" id="sfxBtn" title="音效">🔊</div>
    </div>

    <div class="game-message hidden" id="gameMessage">
        <div class="message-content">
            <h2 class="message-title" id="messageTitle">游戏结束</h2>
            <p class="final-score">最终得分: <span id="finalScore">0</span></p>
            <button class="btn btn-start" id="restartBtn">再玩一次</button>
        </div>
    </div>
</div>

<!-- 音频元素 -->
<audio id="bgm" loop>
    <source src="https://wplcode.xyz:9000/demo/哈基米.mp3" type="audio/mpeg">
</audio>

<audio id="hitSound">
    <source src="https://wplcode.xyz:9000/demo/ji.mp3" type="audio/mpeg">
</audio>

<audio id="missSound">
    <source src="https://wplcode.xyz:9000/demo/aiyou.mp3" type="audio/mpeg">
</audio>

<script>
    // 游戏配置
    const config = {
        gameTime: 30, // 游戏时长（秒）
        moleUpTime: [800, 1200], // 地鼠出现时间范围（毫秒）
        moleInterval: [500, 1000], // 地鼠出现间隔（毫秒）
        scorePerMole: 10, // 每只地鼠得分
        moleCount: 9 // 地鼠洞数量
    };

    // 游戏状态
    let gameState = {
        score: 0,
        timeLeft: config.gameTime,
        gameActive: false,
        timer: null,
        moleTimer: null,
        soundEnabled: {
            bgm: true,
            sfx: true
        }
    };

    // DOM元素
    const elements = {
        gameBoard: document.getElementById('gameBoard'),
        scoreDisplay: document.getElementById('score'),
        timeDisplay: document.getElementById('time'),
        startBtn: document.getElementById('startBtn'),
        stopBtn: document.getElementById('stopBtn'),
        gameMessage: document.getElementById('gameMessage'),
        messageTitle: document.getElementById('messageTitle'),
        finalScore: document.getElementById('finalScore'),
        restartBtn: document.getElementById('restartBtn'),
        bgm: document.getElementById('bgm'),
        hitSound: document.getElementById('hitSound'),
        missSound: document.getElementById('missSound'),
        bgmBtn: document.getElementById('bgmBtn'),
        sfxBtn: document.getElementById('sfxBtn')
    };

    // 初始化游戏
    function initGame() {
        createHoles();
        setupEventListeners();
        updateScore(0);
        updateTime(config.gameTime);
    }

    // 创建地鼠洞
    function createHoles() {
        elements.gameBoard.innerHTML = '';
        for (let i = 0; i < config.moleCount; i++) {
            const hole = document.createElement('div');
            hole.className = 'hole';

            const mole = document.createElement('div');
            mole.className = 'mole';
            mole.dataset.index = i;
            // 使用占位图片，替换为青云头像
            mole.style.backgroundImage = 'url(https://wplcode.xyz:9000/demo/avatar.png)';
            mole.addEventListener('click', hitMole);

            hole.appendChild(mole);
            elements.gameBoard.appendChild(hole);
        }
    }

    // 设置事件监听器
    function setupEventListeners() {
        elements.startBtn.addEventListener('click', startGame);
        elements.stopBtn.addEventListener('click', stopGame);
        elements.restartBtn.addEventListener('click', startGame);
        elements.bgmBtn.addEventListener('click', toggleBGM);
        elements.sfxBtn.addEventListener('click', toggleSFX);
    }

    // 开始游戏
    function startGame() {
        if (gameState.gameActive) return;

        resetGame();
        gameState.gameActive = true;
        elements.gameMessage.classList.add('hidden');

        // 开始计时器
        gameState.timer = setInterval(() => {
            gameState.timeLeft--;
            updateTime(gameState.timeLeft);

            if (gameState.timeLeft <= 0) {
                endGame();
            }
        }, 1000);

        // 开始地鼠出现定时器
        showRandomMole();

        // 播放背景音乐
        if (gameState.soundEnabled.bgm) {
            elements.bgm.play().catch(e => console.log("音频播放失败:", e));
        }
    }

    // 结束游戏
    function endGame() {
        gameState.gameActive = false;
        clearInterval(gameState.timer);
        clearTimeout(gameState.moleTimer);

        // 隐藏所有地鼠
        document.querySelectorAll('.mole.up').forEach(mole => {
            mole.classList.remove('up');
        });

        // 停止背景音乐
        elements.bgm.pause();

        // 显示结束界面
        elements.finalScore.textContent = gameState.score;
        elements.messageTitle.textContent = '游戏结束';
        elements.gameMessage.classList.remove('hidden');
    }

    // 停止游戏
    function stopGame() {
        if (!gameState.gameActive) return;
        endGame();
    }

    // 重置游戏状态
    function resetGame() {
        gameState.score = 0;
        gameState.timeLeft = config.gameTime;
        updateScore(0);
        updateTime(config.gameTime);
    }

    // 随机显示地鼠
    function showRandomMole() {
        if (!gameState.gameActive) return;

        const holes = document.querySelectorAll('.hole');
        const randomIndex = Math.floor(Math.random() * holes.length);
        const mole = holes[randomIndex].querySelector('.mole');

        // 只有当地鼠洞是空的才显示新地鼠
        if (!mole.classList.contains('up')) {
            mole.classList.add('up');

            // 设置地鼠消失时间
            const upTime = getRandomValue(config.moleUpTime);
            setTimeout(() => {
                if (mole.classList.contains('up')) {
                    mole.classList.remove('up');
                    // 播放未击中音效
                    if (gameState.soundEnabled.sfx) {
                        elements.missSound.currentTime = 0;
                        elements.missSound.play().catch(e => console.log("音效播放失败:", e));
                    }
                }
            }, upTime);
        }

        // 设置下一次出现地鼠的时间
        const nextMoleTime = getRandomValue(config.moleInterval);
        gameState.moleTimer = setTimeout(showRandomMole, nextMoleTime);
    }

    // 击中地鼠
    function hitMole(e) {
        if (!gameState.gameActive) return;

        const mole = e.target;
        if (mole.classList.contains('up')) {
            mole.classList.remove('up');
            updateScore(gameState.score + config.scorePerMole);

            // 播放击中音效
            if (gameState.soundEnabled.sfx) {
                elements.hitSound.currentTime = 0;
                elements.hitSound.play().catch(e => console.log("音效播放失败:", e));
            }
        }
    }

    // 更新得分
    function updateScore(newScore) {
        gameState.score = newScore;
        elements.scoreDisplay.textContent = newScore;
    }

    // 更新时间
    function updateTime(newTime) {
        gameState.timeLeft = newTime;
        elements.timeDisplay.textContent = newTime;
    }

    // 获取随机值
    function getRandomValue(range) {
        return Math.floor(Math.random() * (range[1] - range[0] + 1)) + range[0];
    }

    // 切换背景音乐
    function toggleBGM() {
        gameState.soundEnabled.bgm = !gameState.soundEnabled.bgm;
        elements.bgmBtn.classList.toggle('active', gameState.soundEnabled.bgm);

        if (gameState.soundEnabled.bgm && gameState.gameActive) {
            elements.bgm.play().catch(e => console.log("音频播放失败:", e));
        } else {
            elements.bgm.pause();
        }
    }

    // 切换音效
    function toggleSFX() {
        gameState.soundEnabled.sfx = !gameState.soundEnabled.sfx;
        elements.sfxBtn.classList.toggle('active', gameState.soundEnabled.sfx);
    }

    // 页面加载完成后初始化游戏
    window.addEventListener('DOMContentLoaded', initGame);
</script>
</body>
</html>